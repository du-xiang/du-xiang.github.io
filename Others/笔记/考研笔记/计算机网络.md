## 计算机网络

### 物理层

#### 基础概念

物理层解决在传输媒体上如何传输比特流



物理层的**主要任务**：确定传输媒体的有关的特性

* 机械特性：指明接口所用接线器的形状、引脚数目和排列、固定和锁定装置等。
* 电气特性：指明各条线上出现的电压的范围。
* 功能特性：指明某条线上出现的某电平的意义。
* 规程特性：指明对于不同功能的各种事件的出现顺序。



模型：

![数据通信系统](D:\File\笔记\考研笔记\专业课\Image\数据通信系统模型.jpg)



**相关术语**：

* 通信目的：传输信息
* 数据：信息实体，是有意义的符号序列
* 信号：数据的电气/电磁表现，数据在传输中的表现形式
  * 离散/数字信号
  * 连续/模拟信号
* 信源/信宿/信道
  * 信道按传输信号可分为：模拟信道、数字信道
  * 信道按传输介质可分为：有线信道、无线信道



单工/半双工/全双工通信

串行/并行通信

* 串行将字符的8位二进制数字逐个发送，只需一条线路。
* 串行速度慢、费用低，适合远距离通信
* 并行将字符的8位二进制数字同时发送，需八条线路。
* 并行速度快、费用高，适合近距离通信

同步/异步通信

* 同步通信先发送同步字符，再**连续**发送数据（全部被分为数据区块）
* 异步通信为数据加上起始位和终止位后发送，顺序任意



**码元**：用一个**固定时长**的**信号波形**（数字脉冲），代表不同离散数值的波形。是数字通信的计量单位。如果码元的离散状态（可表示的波形数量）有M个，则称为M进制码元。



**速率**：也叫数据率，代表数据传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示。

* **码元传输速率**：又叫码元速率、波形速率、调制速率、符号速率等，单位是波特B（Baud）。码元传输速率R<sub>B</sub>与进制数无关，只与码元长度 T 有关：R<sub>B</sub> = 1/T 。
* **信息传输速率**：又叫信息速率、比特速率等，表示单位时间内传输的二进制码个数（比特数），单位比特/秒（bit/s）。
* **关系**：1个码元携带 N bit信息量，则 M Baud 码元速率对应信息速率为：**M * N** bit/s



**带宽**：

* 模拟信号系统中。输入的信号频率高或低到一定频率时，时系统输出功率变为输入功能的一半，最高与最低的频率之间的差值为系统**通频带宽**，单位赫兹（Hz）
* 数字设备中表示两点间能通过的 ”最高数据率“，单位比特每秒 bps 





#### 两个公式lim

影响失真的因素：1. 码元的传输速率 ；2. 信号传输距离；3. 噪声干扰；4. 传输媒体质量



**码间干扰**：失真的一种现象，是传输的信号频率过高



**奈氏准则：**理想的低通条件下，为避免码间串扰，极限码元传输速率：2W Baud，W是信道带宽单位 Hz。信息速率的计算为：
$$
2W\log_{2}V，单位b/s
$$

* 任何信道中，码元传输速率都有上限。（码间串扰）
* 信道频率越宽（能通过的信息高频分量越多），就可以使用更高的速率进行码元的有效传输
* 奈氏准则给出了码元的传输速率的限制，但未对信息传输速率给出限制
* 由于码元传输速率受奈氏准则制约，若要提高数据传输率，需使每个码元携带更多比特的信息量，就要用到多元制的调制方法



**香农定理：**在带宽受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值

**信噪比：**信号的平均功率/噪声的平均功率（S/N），无单位。若带有单位 dB，信噪比应用如下公式计算
$$
信噪比（dB）=10\log_{2}(S/N)
$$
根据香农公式，**信道极限信息传输速率**为：
$$
W\log_{2}(1+S/N),单位b/s
$$

* 信息中的带宽或信噪比越大，信息极限传输速率越高
* 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了
* 只要信息传输速率低于信道的极限传输速率，就一定有某种方法实现无差错传输
* 香农定理得出的为极限传输速率，实际传输速率要比它低不少
* 从香农定理可看出，若信息带宽和信噪比无上限，则信息极限传输速率无上限





#### 编码与调制

**信道上传送**的信号分为**基带信号**和**宽带信号**



**基带信号：**将数字信号 0 和 1 直接用两种不同的电压表示，再送到数字信道上传输（基带传输）。基带信号就是发出了**直接表达了要传输的信息的信号**

**宽带传输：**将基带信号调制后形成的频分复用模拟信号，传输到模拟信道上进行传输（宽带传输）。把基带信号**载波调制**，把**频率范围搬移**到**较高频段**以便信道传输



**数字/模拟数据**可**<font color="red">编码</font>为数字信号**，可**<font color="red">调制</font>为模拟信号**



**数字数据编码为数字信号**

主要考察前三种编码方式

* （1）非归零编码（2）曼彻斯特编码（3）差分曼彻斯特编码（4）归零编码（4）反向不归零编码（5）4B/5B编码

* 反向不归零编码中翻转表示 1，不翻转表示 0
* 曼彻斯特编码频带宽度为原始基带宽度的2倍，每个码元都被调成两个电平，数据传输效率只有调制速率的一半
* 4B/5B编码中在四个比特上添加一个比特，16 种状态位用于数据，16种状态位用于控制。数据传输效率为80%



**数字数据调制为模拟信号**

* 调幅
* 调频
* 调相
* 正交振幅调相QAM（调相+调幅）



**模拟数据编码为数字信号**

* 抽样：对模拟信号**周期性扫描**，把时间上**连续的信号变为**时间上**离散的信号**。采样频率选取如下
  $$
  f_{采样频率}\geqslant 2f_{信号最高频率}
  $$
  
* 量化：把抽样得到的**电平幅值**按一定的**分级标度转化**为对应的**数字值**，并**取整数**。这样就把连续电平幅值转化为了离散的数字量

* 编码：把量化得到的**结果转化**为对应的**二进制代码**



**模拟数据调制为模拟信号**

为实现传输的有效性，可能需要较高的频率。这种调制方法还可以利用频分复用技术，充分利用宽带资源。例如电话机到交换机的信号传输。





#### 数据交换方式

1. **电路交换：**

**原理**：在数据传输期间，源节点和目的节点之间有一条由中间节点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持

**阶段**：建立连接（呼叫/电路建立）->  通信（数据传输） ->  释放连接（拆除电路）

**特点**：**独占资源**，用户始终占用端到端的固定传输宽带。适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况

| 优点                                                         | 缺点                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **传输延时小**                                               | **建立连接时间长**                                           |
| 数据顺序发送，**无失序问题**                                 | **信道使用效率低**，线路独占，即使通信线路空闲，也不能提供其他用户使用 |
| **实时性强**，双方一旦建立物理通路，便可实时通信             | **灵活性差**，双方连接通路的任何一点出现故障，必须重新拨号建立新连接，不适应突发性通信 |
| **全双工通信**，没有冲突，通信双方由不同的信道，不会争用物理信道 | 无数据存储能力，**难以平滑通信量**                           |
| **适用于模拟信号和数字信号**                                 | 电路交换时，数据直达、不同类型，不同规格、不同速率的**终端很难相互通信** |
| **控制简单**，电路的交换设备及控制较简单                     | **无法发现和纠正传输错误**，难以在通信过程中进行差错控制     |



2. **报文交换：**

**原理**：无需再两个站点间建立一条专用通路，其数据传输的单位是报文，传输过程采用**存储转发**方式

**中间节点**：1. 每个节点收下整个报文后，暂存报文并检查有无错误；2. 当所需要的输出电路空闲时，利用路由信息找到下一个节点地址，并进行传输。（在两个通信用户间的其他线路段，可传输其他用户的报文，不像电路交换那样必须占用端到端的全部信道）

**报文**：报文是网络中交换与传输的数据单元，即站点**一次性要发送的数据块**。报文包括将要发送的完整的数据信息，其长短不一，长度不限且可变

| 优点                                                         | 缺点                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **无需建立连接时延**，用户可随时发送报文                     | **实时性差**。数据进入交换节点后要经历存储转发过程，引发时延 |
| **动态分配线路**，动态选择报文通过的最佳路径，可以平滑通信量 | **只适用于数字信号**                                         |
| **提高线路可靠性**，某条传输路径发送故障，可重新选择另一条路径发送 | 由于报文长度没有限制，中间节点要完整接收传来的整个报文，当输出线路不空闲时，还可能要存储几个完整报文等待转发，要求中间节点有较大的缓冲区，**为了减低成本，中间节点减少缓冲存储器的容量，将等待转发的报文存在磁盘中，进一步增加了时延** |
| **提高线路利用率**，多个报文可共享信道                       |                                                              |
| **提供多目标服务**，一个报文可同时发往多个目的地址           |                                                              |
| **在存储转发中容易实现代码转化和速率匹配**，甚至收发双方可以在不同时处于可用状态。这样就便于类型、规格和速度不同的计算机之间的通信 |                                                              |



3. **分组交换：**

分组交换包括：数据报方式和虚电路方式

**数据报方式**：

1. 源主机**将报文分成多个分组**，依次发送到直接相连的节点
2. 相邻节点收到分组后，对每个分组**差错检测**和**路由选择**，不同分组的下一跳节点可能不同
3. 下一跳节点收到分组后，对分组进行差错检测，若正确则**向上一节点发送确认信息**，上一节点收到确认信息后丢弃该分组副本
4. 所有分组达到目的节点

**数据报方式的特点**：

1. 数据报为网络层提供**无连接服务**
2. 同一报文的不同分组达到目的结点时可能乱序，重复和丢失
3. 每个分组在传输过程中都必须携带源地址和目的地址，以及分组号
4. 分组在交换结点存储转发时，需要排队等候处理，这会带来一定时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可能根据情况丢弃分组
5. 网络具有冗余路径。当某一交换结点或一段链路出现故障时，可相应的更新转发表，寻找另一条路径转发分组，对故障的适应能力较强，适用于突发性通信不适用于长报文、会话式通信

**<font color="red">无连接服务</font>**：不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组的传输路径可能不同

**虚电路方式**：

虚电路将数据报方式和电路交换方式结合，以发挥两者优点

**虚电路**：一条源主机到目的主机类似于电路的路径（逻辑连接），路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路信息

**流程**：

1. 建立连接（虚电路建立）：源主机发送“呼叫请求”分组并收到“呼叫应答”分组后才算建立连接
2. 数据传输：每个分组携带**虚电路号**，分组号，检验等控制信息
3. 释放连接（虚电路释放）：源主机发送“释放请求”分组并拆除虚电路

**虚电路方式特点：**

1. 虚电路方式为网络提供连接服务，源结点与目的结点间建立一条逻辑电路
2. 一次通信的所有分组都通过虚电路顺序发送，分组不需携带源地址、目的地址等信息，包含虚电路号，相对数据报方式开销小同一报文的不同分组到达目的地址时不会乱序，重复和丢失
3. 分组通过虚电路上每个结点时，结点只进行差错处理，不需进行路由选择
4. 每个结点可能与多个结点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同进程服务
5. 致命弱点：当网络中的某个结点或某条链路出现故障而彻底失效时，则通过该链路的虚电路将遭到破坏

|                    | 数据报服务                                                 | 虚电路服务                                           |
| ------------------ | ---------------------------------------------------------- | ---------------------------------------------------- |
| 连接的建立         | 不要                                                       | 必须有                                               |
| 目的地址           | 每个分组都有完整的目的地址                                 | 仅在建立连接使用，之后每个分组使用长度较短地虚电路号 |
| 路由选择           | 每个分组独立地进行路由选择和转发                           | 属于同一条虚电路的分组按照同一路由转发               |
| 分组顺序           | 不保证分组地有序到达                                       | 保证分组的有序达到                                   |
| 可靠性             | 不保证可靠通信，可靠性由用户主机来保证                     | 可靠性有网络提供                                     |
| 对网络故障的适应性 | 出故障地结点丢失分组，其他分组路径选择发送变化，可正常传输 | 所有经过故障结点的虚电路均不能正常工作               |
| 差错处理和流量控制 | 由用户主机进行流量控制，不保证数据报地可靠性               | 可由分组交换网负责，也可由用户主机负责               |

| 优点                                                         | 缺点                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **无建立时延**，无需为通信双方建立一条专用信道               | 尽管分组交换比报文交换传输时延少，但**仍存在存储转发时延**，而且**其节点交换机必须具有更强的处理能力** |
| **线路利用率高**，通信双方在不同时间一段一段的部分占有这条物理通道，多个分组可共享通道 | **每个分组都要加控制信息，一定程度上减低了通信效率，增加了处理的时间** |
| **简化了存储管理**，因为分组的长度固定，相应的缓冲区的大小也固定，在交换节点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易 | 当分组**采用数据报服务时，可能出现失序、丢失或重复分组**，分组到达目的节点时。要**对分组按编号进行排序等工作，增加了麻烦**。若采用**虚电路服务**，虽无失序问题，但**有呼叫建立、数据传输、和虚电路释放三个过程** |
| **加速传输**，后一个分组的存储可以与前一个分组的转发并行操作，传输一个分组比一个报文所需存储区小，减少等待发送时间 |                                                              |
| **减少出错几率和重发数据量，提高可靠性**，减少时延；分组短小，适用计算机之间的突发式数据通信 |                                                              |



4. **数据交换方式的选择**：**1**. 传送数据量大，且传送时间远大呼叫时，选择**电路交换**。电路交换传输时延最小；**2**. 当端到端的通路有很多段的链路组成时，采用**分组交换**传送数据较为合适 ；**3**. 从信道利用率上看，**报文交换和分组交换**优于电路交换，其中分组交换比报文交换的时延小，尤其适合于**计算机之间的突发式数据通信**





#### 传输介质及分类

传输介质也称传输媒体/传输媒介，它就是数据传输系统中在发送设备和接收设备之间的**物理通路**

传输介质分为**导向性传输介质**和**非导向性传输介质**



**导向性传输介质**：

1. **双绞线**：有两根采用一定规则**并排绞合**、相互绝缘的**铜导线**组成

   * **屏蔽双绞线**（STP）：绞合可以减少对相邻导线的电磁干扰。为进一步提高抗电磁干扰，可在双绞线外面再加上一个有**金属丝**编织成的屏蔽层，无屏蔽的双绞线就称为**无屏蔽双绞线(UTP)**
   * 双绞线**价格便宜**，是最常用的传输介质之一。局域网和传统电话网中普遍使用。通信距离一般为数十公里。距离太远时，对于**模拟传输**，要用**放大器**放大衰减的信号；对于数字传输，要用**中继器**将失真的信号整形

   

2. **同轴电缆**：由导体铜质芯、绝缘层、网状编织屏蔽层和塑料外层组成。

   * 根据特性阻抗数值不同，分为50Ω同轴电缆和75Ω同轴电缆。50Ω同轴电缆主要用于传输基带信号，又称为基带同轴电缆，广泛应用于局域网；75Ω同轴电缆主要用于传输宽带信号，又称宽带同轴电缆，主要用于有限电视系统
   * 由于外层屏蔽层的作用，同轴电缆**抗干扰特性比双绞线好**，被**广泛用于传输较高速率的数据**，其**传输距离更远**，但**价格更高**

   

3.  **光纤**：利用光导纤维传递**光脉冲**来进行通信，有光脉冲表示1，无光脉冲表示0

   * 可见光的频率较高，因此光纤系统的带宽**远远大于其他各种传输媒体的带宽**
   
   * 光纤**主要由实心的纤芯和包层构成**。包层有较低的折射率，如果入射角足够大，就会出现**全反射**
   
   |      | 单模光纤                             | 多模光纤                       |
   | ---- | ------------------------------------ | ------------------------------ |
   | 定义 | 一种在**横向模式**直接传输信号的光纤 | 有**多种**传输光信号模式的光纤 |
   | 光源 | **定向**性很好的**激光**二极管       | 发光二极管                     |
   | 特点 | **衰耗小**，适合**远**距离传输       | **易失真**，适合**近**距离传输 |
   
   * **特点**：
     1. 传输**损耗小**，中继长，对远距离传输特别经济
     2. **抗雷电和电磁干扰性能好**
     3. 无串音干扰，保密性好，也**不易被窃听或截取数据**
     4. **体积小，重量轻**



**非导向性传输介质：**

1. **无线电波：**较强**穿透能力**，可远距离传输，广泛用于通信领域（如手机通信）

   * 信号向**所有方向**传播

2. **微波：**微波通信频率较高、频段范围宽，因此数据率很高

   * 信号**固定方向**传播

   * 地面微波接力通信

   * 卫星通信：

     | 优点               | 缺点         |
     | ------------------ | ------------ |
     | 通信容量大         | 传播时延长   |
     | 距离远             | 受天气影响大 |
     | 覆盖广             | 误码率高     |
     | 广播通信和多址通信 | 成本高       |

3. **红外线、激光**：把要传输的信号分别转换为各自的信号格式（即红外光信号和激光信号），再在空间中传播

   * 信号**方向固定**





#### 传输设备

**中继器**：

由于存在损耗，再线路上传输的信号功率会逐渐衰减，衰减到一定程度时会造成信号失真，会直接导致接收错误

**功能**：对信号进行**再生和还原**，对衰减信号进行放大，保持于原数据相同，以增加信号传输的距离，延长网络的长度

**中继器的两端**：

* 两端的网络部分是**网段**，而不是子网，适用于完全相同的**两类网络**的互连，且**两个网段速率要相同**
* 中继器**只将任何电缆段上的数据发送到另一电缆上**，它仅用于信号的电气部分，并不管数据中是否有错误数据或不适用于网段的数据
* 两端可连接相同媒体，也可连接不同媒体
* 中继器两端的**网段一定要是同一个协议**，（中继器不会存储转发）

**5-4-3规则**：网络标准中都对信号的延迟范围做出了具体的规定，因而中继器只能再规定的范围内进行，否则会网络故障



**集线器（多口中继器）**：对信号进行**再生放大转发**，对衰减的信号进行放大，接着转发到其他所有（除输入端口外）处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。不具备信号的定向传送能力，是一个共享式设备

* 集线器不能分割冲突域，将由连在集线器上的工作主机平分带宽



